<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Homepage</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="stars-canvas"></canvas>
    <img src="dune-letscher.png" alt="Dune Letscher" class="dune-bg">
    <div class="container">
        <h1>Hello, World!</h1>
        <div class="profile-pic-wrapper">
            <img src="ai-drawn-tim.jpg" alt="AI Drawn Tim" class="profile-pic">
        </div>
        <button class="contact-btn">Services</button>
        <button class="contact-btn">Featured Work</button>
                <button class="contact-btn">Hit Me Up!</button>

                <!-- Weather Widget Start -->
                <div id="weather-widget" class="weather-widget">
                    <div class="weather-header">
                        <h3>Weather</h3>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <button id="unit-toggle" class="location-btn" style="font-size:0.95rem;">¬∞C / ¬∞F</button>
                            <button id="location-btn" class="location-btn">üìç Get Location</button>
                        </div>
                    </div>
                    <div id="weather-content" class="weather-content">
                        <div class="loading">Loading weather data...</div>
                    </div>
                </div>
                <!-- Weather Widget End -->
    </div>
</body>
<script>
// Twinkling stars using canvas
const canvas = document.getElementById('stars-canvas');
const ctx = canvas.getContext('2d');
let width = window.innerWidth;
let height = window.innerHeight;
canvas.width = width;
canvas.height = height;
canvas.style.position = 'fixed';
canvas.style.top = 0;
canvas.style.left = 0;
canvas.style.width = '100vw';
canvas.style.height = '100vh';
canvas.style.zIndex = 0;
canvas.style.pointerEvents = 'none';

function resizeCanvas() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
}
window.addEventListener('resize', resizeCanvas);

const STAR_COUNT = 80;
const stars = [];
for (let i = 0; i < STAR_COUNT; i++) {
    stars.push({
        x: Math.random() * width,
        y: Math.random() * height,
        r: Math.random() * 1.2 + 0.6,
        twinkle: Math.random() * Math.PI * 2,
        speed: Math.random() * 0.02 + 0.01
    });
}

function drawStars() {
    ctx.clearRect(0, 0, width, height);
    for (const star of stars) {
        const alpha = 0.5 + 0.5 * Math.sin(star.twinkle);
        ctx.globalAlpha = alpha;
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.r, 0, 2 * Math.PI);
        ctx.fillStyle = '#fff';
        ctx.fill();
        star.twinkle += star.speed;
    }
    ctx.globalAlpha = 1;
    requestAnimationFrame(drawStars);
}
drawStars();

// Weather Widget Logic with C/F toggle
const weatherContent = document.getElementById('weather-content');
const locationBtn = document.getElementById('location-btn');
const unitToggle = document.getElementById('unit-toggle');
let tempUnit = 'celsius'; // 'celsius' or 'fahrenheit'
let lastCoords = { lat: 47.6062, lon: -122.3321 };
let lastWeatherData = null;

function displayWeather(data) {
    lastWeatherData = data;
    if (!data || !data.current_weather) {
        weatherContent.innerHTML = '<div class="loading">Weather data unavailable.</div>';
        return;
    }
    const w = data.current_weather;
    let temp = w.temperature;
    let unitLabel = tempUnit === 'celsius' ? '¬∞C' : '¬∞F';
    if (tempUnit === 'fahrenheit') {
        temp = Math.round(temp * 9/5 + 32);
    } else {
        temp = Math.round(temp);
    }
    const html = `
        <div style="display:flex;align-items:center;gap:12px;">
            <div style="font-size:2.2rem;">${getWeatherIcon(w.weathercode)}</div>
            <div>
                <div style="font-size:1.5rem;font-weight:bold;">${temp}${unitLabel}</div>
                <div style="font-size:1rem;">${getWeatherDescription(w.weathercode)}</div>
                <div style="font-size:0.95rem;opacity:0.8;">Wind: ${Math.round(w.windspeed)} km/h</div>
            </div>
        </div>
    `;
    weatherContent.innerHTML = html;
}

function getWeatherIcon(code) {
    // Simple mapping for demo
    if ([0].includes(code)) return '‚òÄÔ∏è';
    if ([1,2,3].includes(code)) return '‚õÖÔ∏è';
    if ([45,48].includes(code)) return 'üå´Ô∏è';
    if ([51,53,55,56,57,61,63,65,66,67,80,81,82].includes(code)) return 'üåßÔ∏è';
    if ([71,73,75,77,85,86].includes(code)) return '‚ùÑÔ∏è';
    if ([95,96,99].includes(code)) return '‚õàÔ∏è';
    return '‚ùî';
}
function getWeatherDescription(code) {
    const map = {
        0: 'Clear sky', 1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast',
        45: 'Fog', 48: 'Depositing rime fog',
        51: 'Light drizzle', 53: 'Drizzle', 55: 'Dense drizzle',
        56: 'Freezing drizzle', 57: 'Dense freezing drizzle',
        61: 'Slight rain', 63: 'Rain', 65: 'Heavy rain',
        66: 'Freezing rain', 67: 'Heavy freezing rain',
        71: 'Slight snow', 73: 'Snow', 75: 'Heavy snow',
        77: 'Snow grains', 80: 'Rain showers', 81: 'Heavy rain showers', 82: 'Violent rain showers',
        85: 'Snow showers', 86: 'Heavy snow showers',
        95: 'Thunderstorm', 96: 'Thunderstorm w/ hail', 99: 'Thunderstorm w/ heavy hail'
    };
    return map[code] || 'Unknown';
}

function fetchWeather(lat, lon) {
    lastCoords = { lat, lon };
    weatherContent.innerHTML = '<div class="loading">Loading weather data...</div>';
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=${tempUnit}`;
    fetch(url)
        .then(r => r.json())
        .then(displayWeather)
        .catch(() => {
            weatherContent.innerHTML = '<div class="loading">Weather data unavailable.</div>';
        });
}

function getLocationAndFetchWeather() {
    if (!navigator.geolocation) {
        weatherContent.innerHTML = '<div class="loading">Geolocation not supported.</div>';
        return;
    }
    weatherContent.innerHTML = '<div class="loading">Getting your location...</div>';
    navigator.geolocation.getCurrentPosition(
        pos => {
            fetchWeather(pos.coords.latitude, pos.coords.longitude);
        },
        err => {
            weatherContent.innerHTML = '<div class="loading">Location denied. Showing Seattle, WA.</div>';
            // Default to Seattle, WA
            fetchWeather(47.6062, -122.3321);
        }
    );
}

locationBtn.addEventListener('click', getLocationAndFetchWeather);
unitToggle.addEventListener('click', () => {
    tempUnit = tempUnit === 'celsius' ? 'fahrenheit' : 'celsius';
    fetchWeather(lastCoords.lat, lastCoords.lon);
});

// On load, show default (Seattle, WA)
fetchWeather(47.6062, -122.3321);
</script>
</html>
